<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST: Sistema Multi-Tenant - Impulso</title>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 3rem auto;
            padding: 2rem;
        }
        .test-header {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        .test-card {
            background: var(--color-bg-secondary);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
        }
        .test-card h3 {
            color: var(--color-primary);
            margin-bottom: 1rem;
        }
        .test-value {
            background: var(--color-bg-primary);
            padding: 0.75rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--color-primary);
        }
        .test-icons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .test-icon {
            width: 48px;
            height: 48px;
            padding: 0.75rem;
            background: var(--color-bg-primary);
            border-radius: 8px;
            border: 2px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .test-icon svg {
            width: 100%;
            height: 100%;
            color: var(--color-primary);
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .feature-list li.enabled {
            background: rgba(40, 167, 69, 0.1);
            color: var(--color-success);
        }
        .feature-list li.disabled {
            background: rgba(220, 53, 69, 0.1);
            color: var(--color-error);
            opacity: 0.6;
        }
        .dictionary-demo {
            background: var(--color-bg-primary);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--color-primary);
            margin: 2rem 0;
        }
        .btn-switch {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: var(--color-secondary);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            margin: 0.5rem;
            transition: all 0.3s;
        }
        .btn-switch:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body>

    <div class="test-container">
        <!-- Header de prueba -->
        <div class="test-header">
            <h1>üß™ TEST: Sistema Multi-Tenant Whitelabel</h1>
            <p data-brand="tagline">Sistema de configuraci√≥n din√°mica por dominio</p>
            <p style="font-size: 0.9rem; opacity: 0.9; margin-top: 1rem;">
                Tenant actual: <strong id="currentTenant">Cargando...</strong>
            </p>
        </div>

        <!-- Grid de pruebas -->
        <div class="test-grid">
            <!-- Card 1: Informaci√≥n del Tenant -->
            <div class="test-card">
                <h3>üìã Informaci√≥n del Tenant</h3>
                <div class="test-value">
                    <strong>ID:</strong> <span id="tenantId">-</span>
                </div>
                <div class="test-value">
                    <strong>Nombre:</strong> <span id="tenantName" data-brand="name">-</span>
                </div>
                <div class="test-value">
                    <strong>Dominio:</strong> <span id="tenantDomain">-</span>
                </div>
                <div class="test-value">
                    <strong>Tipo:</strong> <span id="professionalType">-</span>
                </div>
            </div>

            <!-- Card 2: Tema Aplicado -->
            <div class="test-card">
                <h3>üé® Tema CSS Aplicado</h3>
                <div class="test-value">
                    <strong>Color Primario:</strong> <span id="primaryColor">-</span>
                    <div style="width: 30px; height: 30px; background: var(--color-primary); border-radius: 4px; margin-top: 0.5rem;"></div>
                </div>
                <div class="test-value">
                    <strong>Color Secundario:</strong> <span id="secondaryColor">-</span>
                    <div style="width: 30px; height: 30px; background: var(--color-secondary); border-radius: 4px; margin-top: 0.5rem;"></div>
                </div>
                <div class="test-value">
                    <strong>Fuente Principal:</strong> <span id="fontPrimary">-</span>
                </div>
            </div>

            <!-- Card 3: Pack de Iconos -->
            <div class="test-card">
                <h3>üéØ Pack de Iconos</h3>
                <div class="test-value">
                    <strong>Pack Activo:</strong> <span id="iconPack">-</span>
                </div>
                <div class="test-icons" id="iconPreview">
                    <!-- Se cargar√°n din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Demostraci√≥n de Diccionario Sem√°ntico -->
        <div class="dictionary-demo">
            <h2>üìù Demostraci√≥n: Diccionario Sem√°ntico</h2>
            <p style="margin-bottom: 1rem;">Los siguientes textos se adaptan seg√∫n el tenant:</p>

            <div style="background: var(--color-bg-secondary); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                <p><strong>Gestiona tus {{client_term}}</strong></p>
                <p>Agenda una nueva {{session_term}} con tu {{client_term_singular}}</p>
                <p>{{dashboard_term}}: Tu espacio de trabajo</p>
                <p>{{booking_term}} disponible en el {{calendar_term}}</p>
            </div>

            <div style="margin-top: 1rem; padding: 1rem; background: var(--color-bg-neutral); border-radius: 8px;">
                <p style="font-size: 0.9rem; color: var(--color-text-light);">
                    <strong>Nota t√©cnica:</strong> Los placeholders <code>{{term}}</code> se reemplazan autom√°ticamente
                    por los valores del diccionario del tenant. Por ejemplo:
                </p>
                <ul style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--color-text-muted);">
                    <li>Impulso Pro: "Clientes" / "Sesi√≥n" / "Panel de Control"</li>
                    <li>Impulso Hol: "Consultantes" / "Consulta" / "Tu Espacio Sagrado"</li>
                </ul>
            </div>
        </div>

        <!-- Feature Flags -->
        <div class="test-card" style="grid-column: 1 / -1;">
            <h3>üîß Feature Flags Activos</h3>
            <p style="margin-bottom: 1rem; color: var(--color-text-light);">
                Funcionalidades habilitadas/deshabilitadas seg√∫n el tenant:
            </p>
            <ul class="feature-list" id="featureList">
                <!-- Se cargar√°n din√°micamente -->
            </ul>
        </div>

        <!-- Botones de Simulaci√≥n -->
        <div style="text-align: center; margin-top: 3rem; padding: 2rem; background: var(--color-bg-secondary); border-radius: 12px;">
            <h3>üîÑ Simular Cambio de Tenant</h3>
            <p style="margin-bottom: 1rem; color: var(--color-text-light);">
                En producci√≥n, el tenant se detecta autom√°ticamente por el dominio.<br>
                Para testing local, edita el <code>domainMap</code> en <code>config-loader.js</code>
            </p>
            <a href="?tenant=impulso_pro" class="btn-switch">‚Üí Impulso Pro (Corporate)</a>
            <a href="?tenant=impulso_hol" class="btn-switch">‚Üí Impulso Hol (Mystic)</a>
        </div>

        <!-- Log de Consola -->
        <div class="test-card" style="grid-column: 1 / -1; margin-top: 2rem;">
            <h3>üìä Estado de Carga</h3>
            <div id="loadingStatus" style="font-family: 'Courier New', monospace; font-size: 0.85rem; background: #1e1e1e; color: #00ff00; padding: 1rem; border-radius: 8px; max-height: 300px; overflow-y: auto;">
                Esperando carga de configuraci√≥n...
            </div>
        </div>
    </div>

    <!-- Script de Config Loader -->
    <script src="js/config-loader.js"></script>

    <!-- Script de Testing -->
    <script>
        // Esperar a que se cargue la configuraci√≥n
        document.addEventListener('tenantConfigLoaded', function(event) {
            const config = event.detail;

            console.log('‚úÖ Configuraci√≥n cargada en test-multitenant.html:', config);

            // Actualizar informaci√≥n del tenant
            document.getElementById('currentTenant').textContent = config.tenant_id;
            document.getElementById('tenantId').textContent = config.tenant_id;
            document.getElementById('tenantName').textContent = config.brand.name;
            document.getElementById('tenantDomain').textContent = config.domain;
            document.getElementById('professionalType').textContent = config.professional_type;

            // Actualizar tema
            document.getElementById('primaryColor').textContent = config.theme.primary_color;
            document.getElementById('secondaryColor').textContent = config.theme.secondary_color;
            document.getElementById('fontPrimary').textContent = config.theme.font_primary;

            // Actualizar pack de iconos
            document.getElementById('iconPack').textContent = config.icon_pack;

            // Cargar preview de iconos
            loadIconPreview(config.icon_pack);

            // Cargar lista de features
            loadFeatureList(config.features);

            // Actualizar log de estado
            updateLoadingStatus([
                '‚úì Tenant detectado: ' + config.tenant_id,
                '‚úì Tema CSS aplicado: ' + config.theme.primary_color,
                '‚úì Diccionario sem√°ntico aplicado',
                '‚úì Feature flags aplicados',
                '‚úì Pack de iconos cargado: ' + config.icon_pack,
                '',
                '‚úÖ Sistema Multi-Tenant funcionando correctamente'
            ]);
        });

        function loadIconPreview(iconPack) {
            const iconPreview = document.getElementById('iconPreview');
            const icons = ['calendar', 'user', 'success'];

            iconPreview.innerHTML = icons.map(icon => {
                return `
                    <div class="test-icon">
                        <img src="/assets/icons/${iconPack}/${icon}.svg" alt="${icon}" />
                    </div>
                `;
            }).join('');
        }

        function loadFeatureList(features) {
            const featureList = document.getElementById('featureList');

            const featureNames = {
                'carta_astral': 'Carta Astral',
                'fases_lunares': 'Fases Lunares',
                'rituales': 'Rituales',
                'facturacion_avanzada': 'Facturaci√≥n Avanzada',
                'membresia': 'Sistema de Membres√≠a',
                'area_miembros': '√Årea de Miembros',
                'eventos_vivo': 'Eventos en Vivo',
                'cursos_online': 'Cursos Online'
            };

            featureList.innerHTML = Object.keys(features)
                .filter(key => featureNames[key])
                .map(key => {
                    const enabled = features[key];
                    const icon = enabled ? '‚úì' : '‚úó';
                    const className = enabled ? 'enabled' : 'disabled';
                    return `<li class="${className}">${icon} ${featureNames[key]}</li>`;
                }).join('');
        }

        function updateLoadingStatus(messages) {
            const status = document.getElementById('loadingStatus');
            status.innerHTML = messages.map(msg => `<div>${msg}</div>`).join('');
        }
    </script>

</body>
</html>
